# Payment API Documentation

## –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞

### POST /api/v2/payments/create

–°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π –ø–ª–∞—Ç–µ–∂ —á–µ—Ä–µ–∑ YooKassa API –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç URL –¥–ª—è –æ–ø–ª–∞—Ç—ã.

**üîí –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:**
- JWT —Ç–æ–∫–µ–Ω –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ Authorization: Bearer <token>
- –¢–æ–∫–µ–Ω –ø–æ–ª—É—á–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ /auth/verify –ø–æ—Å–ª–µ Telegram –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- –ú–∞–∫—Å–∏–º—É–º 10 –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π –∑–∞ 5 –º–∏–Ω—É—Ç
- userId –±–µ—Ä–µ—Ç—Å—è –∏–∑ JWT —Ç–æ–∫–µ–Ω–∞ (–∑–∞—â–∏—Ç–∞ –æ—Ç IDOR)

#### –ó–∞–ø—Ä–æ—Å

**–ó–∞–≥–æ–ª–æ–≤–∫–∏:**
```
Authorization: Bearer <jwt-token>
Content-Type: application/json
```

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "product": "monthly",
  "returnUrl": "https://burlive.ru/payment/success",
  "description": "BurLive - –º–µ—Å—è—á–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ (30 –¥–Ω–µ–π) ‚Ä¢ 299 ‚ÇΩ"
}
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** `userId` –±–æ–ª—å—à–µ –Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ —Ç–µ–ª–µ –∑–∞–ø—Ä–æ—Å–∞ - –æ–Ω –±–µ—Ä–µ—Ç—Å—è –∏–∑ JWT —Ç–æ–∫–µ–Ω–∞ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã

- `userId` (string, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π) - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `product` (string, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π) - –¢–∏–ø –ø–æ–¥–ø–∏—Å–∫–∏: "monthly", "quarterly", "yearly"
- `returnUrl` (string, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π) - URL –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã
- `description` (string, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π) - –û–ø–∏—Å–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞

#### –û—Ç–≤–µ—Ç

```json
{
  "paymentUrl": "https://yoomoney.ru/api-pages/v2/payment-confirm/epl?orderId=23d93cac-000f-5000-8000-126628f15141",
  "paymentId": "23d93cac-000f-5000-8000-126628f15141"
}
```

#### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- –¶–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–≥–æ—Ä—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —Å–∏—Å—Ç–µ–º–∞ —Å–∫–∏–¥–æ–∫ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–ª—é—á –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
- –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è —Å–æ–±—ã—Ç–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è —á–µ–∫ —Å email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∏–ª–∏ fallback –Ω–∞ userId@burlive.ru)
- –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Å—Ä–æ–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –∏ —Ü–µ–Ω—ã

#### –ü—Ä–∏–º–µ—Ä—ã –æ–ø–∏—Å–∞–Ω–∏–π –ø–ª–∞—Ç–µ–∂–µ–π

- **–ú–µ—Å—è—á–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞**: "–ò–Ω–≥–ª–∏—à –≤ –¢–ì - –º–µ—Å—è—á–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ (30 –¥–Ω–µ–π) ‚Ä¢ 299 ‚ÇΩ"
- **–ö–≤–∞—Ä—Ç–∞–ª—å–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞**: "–ò–Ω–≥–ª–∏—à –≤ –¢–ì - –∫–≤–∞—Ä—Ç–∞–ª—å–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ (90 –¥–Ω–µ–π) ‚Ä¢ 799 ‚ÇΩ"  
- **–ì–æ–¥–æ–≤–∞—è –ø–æ–¥–ø–∏—Å–∫–∞**: "–ò–Ω–≥–ª–∏—à –≤ –¢–ì - –≥–æ–¥–æ–≤–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ (365 –¥–Ω–µ–π) ‚Ä¢ 2999 ‚ÇΩ"

#### üß™ –¢–µ—Å—Ç–æ–≤—ã–µ –ø–ª–∞—Ç–µ–∂–∏ (10‚ÇΩ)

–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ –±–æ–µ–≤–æ–º –º–∞–≥–∞–∑–∏–Ω–µ YooKassa –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ userId, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π —Å–ª–æ–≤–æ "test":

**1. –°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
```bash
POST /api/v2/auth/test-user
Content-Type: application/json

{
  "userId": "test_user_1272270574",
  "firstName": "Test User",
  "email": "test@example.com"
}
```

**2. –°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –ø–ª–∞—Ç–µ–∂:**
```bash
POST /api/v2/payments/create
Content-Type: application/json

{
  "userId": "test_user_1272270574",
  "product": "monthly",
  "returnUrl": "https://example.com/success"
}
```

**–ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤—ã—Ö userId:**
- `1272270574` (—Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç–æ–≤—ã–π ID)
- `test_user_123`
- `user_test_456` 
- `test_payment_789`

**–¢–µ—Å—Ç–æ–≤—ã–µ —Ü–µ–Ω—ã:**
- –ú–µ—Å—è—á–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞: **10‚ÇΩ**
- –ö–≤–∞—Ä—Ç–∞–ª—å–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞: **10‚ÇΩ**
- –ì–æ–¥–æ–≤–∞—è –ø–æ–¥–ø–∏—Å–∫–∞: **10‚ÇΩ**

**–û–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞:**
`[–¢–ï–°–¢] –ò–Ω–≥–ª–∏—à –≤ –¢–ì - –º–µ—Å—è—á–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ (30 –¥–Ω–µ–π) ‚Ä¢ 10 ‚ÇΩ`

## –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø–ª–∞—Ç–µ–∂–∞

### GET /api/v2/payments/status?paymentId={paymentId}

–ü–æ–ª—É—á–∞–µ—Ç —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞ –∏–∑ YooKassa.

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞

- `paymentId` (string, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π) - ID –ø–ª–∞—Ç–µ–∂–∞ –≤ YooKassa

#### –û—Ç–≤–µ—Ç

```json
{
  "status": "succeeded",
  "paid": true
}
```

#### –í–æ–∑–º–æ–∂–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã

- `pending` - –û–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã
- `succeeded` - –£—Å–ø–µ—à–Ω–æ –æ–ø–ª–∞—á–µ–Ω
- `canceled` - –û—Ç–º–µ–Ω–µ–Ω

## Webhook –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### POST /api/v2/payments/webhook/yookassa

–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç YooKassa –æ —Å—Ç–∞—Ç—É—Å–µ –ø–ª–∞—Ç–µ–∂–∞.

#### –ó–∞–≥–æ–ª–æ–≤–∫–∏

- `Idempotence-Key` - –ö–ª—é—á –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –æ—Ç YooKassa

#### –¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞

```json
{
  "event": "payment.succeeded",
  "object": {
    "id": "23d93cac-000f-5000-8000-126628f15141",
    "amount": {
      "value": "100.00",
      "currency": "RUB"
    },
    "metadata": {
      "userId": "12345",
      "product": "monthly"
    }
  }
}
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–î–æ–±–∞–≤—å—Ç–µ –≤ `.env` —Ñ–∞–π–ª:

```env
YOOKASSA_SHOP_ID=your_shop_id_here
YOOKASSA_SECRET_KEY=your_secret_key_here
YOOKASSA_API_URL=https://api.yookassa.ru/v3
JWT_SECRET=your-super-secret-jwt-key-here
```

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ JWT —Ç–æ–∫–µ–Ω–∞

```bash
curl -X GET "https://burlive.ru/api/v2/auth/verify?user=%7B%22id%22%3A12345%7D&auth_date=1735862400&hash=REAL_HASH"
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "userId": "12345",
  "isFirstOpen": false,
  "onboardingCompleted": true,
  "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

### 2. –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞

```bash
curl -X POST https://burlive.ru/api/v2/payments/create \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." \
  -H "Content-Type: application/json" \
  -d '{
    "product": "monthly",
    "returnUrl": "https://burlive.ru/payment/success"
  }'
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞

```bash
curl -X GET "https://burlive.ru/api/v2/payments/status?paymentId=23d93cac-000f-5000-8000-126628f15141"
```

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º

1. –ü–æ–ª—É—á–∏—Ç–µ URL –¥–ª—è –æ–ø–ª–∞—Ç—ã —á–µ—Ä–µ–∑ `/api/v2/payments/create`
2. –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤—å—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ `paymentUrl`
3. –ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–µ—Ä–Ω–µ—Ç—Å—è –Ω–∞ `returnUrl`
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞ —á–µ—Ä–µ–∑ `/api/v2/payments/status`
5. Webhook –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–∏—Ç –ø–æ–¥–ø–∏—Å–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç–µ
