                        # Настройка API бота для логирования платежей

## Переменные окружения

Добавьте следующие переменные в ваш `.env` файл:

```env
# Bot API configuration for payment logging
BOT_API_URL=https://your-domain.com
BOT_API_KEY=your_api_key_here
```

## Описание переменных

- `BOT_API_URL` - URL вашего API бота (например: `https://your-domain.com`)
- `BOT_API_KEY` - API ключ для авторизации запросов к боту

## Логирование

Система автоматически отправляет два типа логов в API бота:

### 1. Логирование создания платежа

Отправляется при создании платежа в YooKassa:

**Endpoint:** `POST {BOT_API_URL}/api/payment-creation-log`

**Данные:**
```json
{
  "userId": 123456789,
  "username": "testuser",
  "firstName": "Иван",
  "lastName": "Петров",
  "paymentId": "pay_1234567890",
  "amount": 299.00,
  "currency": "RUB",
  "tariffName": "Премиум на месяц",
  "utm": {
    "utm_source": "telegram",
    "utm_medium": "bot"
  }
}
```

### 2. Логирование успешного платежа

Отправляется при получении webhook от YooKassa о успешной оплате:

**Endpoint:** `POST {BOT_API_URL}/api/payment-log`

**Данные:**
```json
{
  "userId": 123456789,
  "paymentId": "pay_1234567890",
  "amount": 299.00,
  "currency": "RUB",
  "registrationTime": "2024-01-15T09:00:00.000Z",
  "paymentTime": "2024-01-15T10:30:00.000Z"
}
```

## Названия тарифов

Система автоматически преобразует типы продуктов в понятные названия:

- `monthly` → "Премиум на месяц"
- `quarterly` → "Премиум на квартал"
- `yearly` → "Премиум на год"

## Обработка ошибок

- Если переменные окружения не настроены, логирование пропускается с предупреждением
- Ошибки логирования не влияют на основную функциональность платежей
- Все ошибки логируются в консоль приложения

## Безопасность

- Используйте HTTPS для `BOT_API_URL`
- Храните `BOT_API_KEY` в безопасном месте
- Не коммитьте `.env` файл в репозиторий
