# üîí –ú–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—Ç–≤–µ—Ç–æ–≤: –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞ –∫ —Å–µ—Ä–≤–µ—Ä—É

## üö® **–ü—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ –≤ —Ç–æ–º, —á—Ç–æ:**

1. **–§—Ä–æ–Ω—Ç–µ–Ω–¥ –ø–æ–ª—É—á–∞–ª –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã** —á–µ—Ä–µ–∑ `/content/lessons/:lessonRef`
2. **–§—Ä–æ–Ω—Ç–µ–Ω–¥ —Å–∞–º –æ–ø—Ä–µ–¥–µ–ª—è–ª –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å** –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–ª `isCorrect: true/false`
3. **–°–µ—Ä–≤–µ—Ä –ø—Ä–∏–Ω–∏–º–∞–ª —ç—Ç–æ –Ω–∞ –≤–µ—Ä—É** –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏

## ‚úÖ **–¢–µ–ø–µ—Ä—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**

1. **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã —É–±—Ä–∞–Ω—ã –∏–∑ API** (—Ä–µ–∫—É—Ä—Å–∏–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è `redact()`)
2. **–°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π –±–µ–∑–æ–ø–∞—Å–Ω—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç** `POST /progress/submit-answer`
3. **–í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ** —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `AnswerValidatorService`

---

## üîç **–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ:**

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Ç–µ—á–∫—É –æ—Ç–≤–µ—Ç–æ–≤:
```bash
# –î–æ–ª–∂–Ω–æ –ù–ï —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ø–æ–ª—è: correctIndex, answer, expected, target
curl "https://your-api.com/content/lessons/a0.basics.001?userId=123456&lang=ru"
```

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–æ–≤—ã–π –±–µ–∑–æ–ø–∞—Å–Ω—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç:
```bash
curl -X POST "https://your-api.com/progress/submit-answer" \
  -H "Content-Type: application/json" \
  -H "idempotency-key: test-123" \
  -d '{
    "userId": "123456",
    "lessonRef": "a0.basics.001",
    "taskRef": "a0.basics.001.t1",
    "userAnswer": "Hello"
  }'
```

**–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:**
```json
{
  "attemptId": "...",
  "isCorrect": true,
  "score": 1.0,
  "feedback": "Correct!",
  "correctAnswer": "Hello"
}
```

---

## üîÑ **–ú–∏–≥—Ä–∞—Ü–∏—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ (2 —ç—Ç–∞–ø–∞):**

### **–≠—Ç–∞–ø 1: –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥**

–§—Ä–æ–Ω—Ç–µ–Ω–¥ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **–æ–±–∞** —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ:

```javascript
// –ù–æ–≤—ã–π –±–µ–∑–æ–ø–∞—Å–Ω—ã–π —Å–ø–æ—Å–æ–±
async function submitAnswer(taskRef, userAnswer) {
  const response = await fetch('/progress/submit-answer', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'idempotency-key': generateUniqueId()
    },
    body: JSON.stringify({
      userId: currentUserId,
      lessonRef: currentLessonRef,
      taskRef: taskRef,
      userAnswer: userAnswer,
      // –ë–æ–ª—å—à–µ –ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º isCorrect –∏ correctAnswer!
    })
  });
  
  const result = await response.json();
  
  // –°–µ—Ä–≤–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏
  showFeedback(result.isCorrect, result.feedback, result.correctAnswer);
  
  return result;
}
```

### **–≠—Ç–∞–ø 2: –ü–æ–ª–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥**

–ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ —É–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç `/progress/attempts`.

---

## üìã **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:**

### **Choice/Multiple Choice:**
```json
// –§—Ä–æ–Ω—Ç–µ–Ω–¥ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏–Ω–¥–µ–∫—Å –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞
"userAnswer": "1"

// –°–µ—Ä–≤–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å correctIndex –∏–∑ –±–∞–∑—ã
```

### **Gap (–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–ø—É—Å–∫–æ–≤):**
```json
// –§—Ä–æ–Ω—Ç–µ–Ω–¥ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤–≤–µ–¥–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç
"userAnswer": "apple"

// –°–µ—Ä–≤–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å answer + alternatives –∏–∑ –±–∞–∑—ã
```

### **Order (—É–ø–æ—Ä—è–¥–æ—á–∏–≤–∞–Ω–∏–µ):**
```json
// –§—Ä–æ–Ω—Ç–µ–Ω–¥ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –º–∞—Å—Å–∏–≤ —Å–ª–æ–≤
"userAnswer": "[\"What\", \"time\", \"is\", \"it\", \"?\"]"

// –°–µ—Ä–≤–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ—Ä—è–¥–æ–∫ + —á–∞—Å—Ç–∏—á–Ω—ã–µ –±–∞–ª–ª—ã
```

### **Translate (–ø–µ—Ä–µ–≤–æ–¥):**
```json
// –§—Ä–æ–Ω—Ç–µ–Ω–¥ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–µ—Ä–µ–≤–æ–¥
"userAnswer": "How much is it?"

// –°–µ—Ä–≤–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ –≤—Å–µ–º–∏ –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ –∏–∑ expected[]
```

### **Listen/Speak (–∞—É–¥–∏–æ):**
```json
// –§—Ä–æ–Ω—Ç–µ–Ω–¥ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–π/–ø—Ä–æ–∏–∑–Ω–µ—Å–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç
"userAnswer": "Hello, how are you?"

// –°–µ—Ä–≤–µ—Ä —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Å target + similarity scoring
```

---

## üîß **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏:**

### **–ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã:**
- `src/modules/progress/dto/submit-answer.dto.ts` - DTO –¥–ª—è –Ω–æ–≤–æ–≥–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞
- `src/modules/progress/answer-validator.service.ts` - –°–µ—Ä–≤–∏—Å –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–æ–≤
- `src/modules/common/guards/telegram-auth.guard.ts` - –£–ª—É—á—à–µ–Ω–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

### **–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
- `src/modules/progress/progress.controller.ts` - –ù–æ–≤—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç `/submit-answer`
- `src/modules/progress/progress.module.ts` - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- `src/modules/common/utils/mappers.ts` - –£–¥–∞–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤ –∏–∑ API

---

## üõ°Ô∏è **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã:**

1. **üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –Ω–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç
2. **üéØ –¢–æ—á–Ω–æ—Å—Ç—å:** –£–º–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å —É—á–µ—Ç–æ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
3. **üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞:** –°–µ—Ä–≤–µ—Ä –≤–∏–¥–∏—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
4. **üöÄ –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å:** –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å ML-–≤–∞–ª–∏–¥–∞—Ü–∏—é, –∞–Ω—Ç–∏—á–∏—Ç –∏ –¥—Ä.
5. **üîß –ì–∏–±–∫–æ—Å—Ç—å:** –ß–∞—Å—Ç–∏—á–Ω—ã–µ –±–∞–ª–ª—ã, –ø–æ–¥—Å–∫–∞–∑–∫–∏, –æ–±—ä—è—Å–Ω–µ–Ω–∏—è

---

## ‚ö° **–ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏:**

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Å–±–æ—Ä–∫–∞ –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ
npm run build

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (–Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —É—Ç–µ—á–µ–∫)
npm run validate:content

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
npm run start:dev

# 4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç (—Å–º. curl –≤—ã—à–µ)
```

---

## üîÑ **–ü–ª–∞–Ω —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è:**

### **–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ:**
1. ‚úÖ –î–µ–ø–ª–æ–π —Å –Ω–æ–≤—ã–º —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–º (–æ–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ)
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —É—Ç–µ—á–∫–∏ –æ—Ç–≤–µ—Ç–æ–≤ –≤ API

### **–í —Ç–µ—á–µ–Ω–∏–µ –Ω–µ–¥–µ–ª–∏:**
1. üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `/submit-answer`
2. üîÑ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ staging

### **–ß–µ—Ä–µ–∑ 2 –Ω–µ–¥–µ–ª–∏:**
1. üìä –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç `/attempts`
2. üéØ –î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é –∏ –∞–Ω—Ç–∏—á–∏—Ç

–¢–µ–ø–µ—Ä—å –≤–∞—à–∞ —Å–∏—Å—Ç–µ–º–∞ –±–µ–∑–æ–ø–∞—Å–Ω–∞! üöÄ
