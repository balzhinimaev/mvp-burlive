# üîí –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

## ‚úÖ **–£–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**

1. **–£—Å—Ç—Ä–∞–Ω–µ–Ω–∞ —É—Ç–µ—á–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤**: –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π —Å –æ—Ç–≤–µ—Ç–∞–º–∏ –∏–∑ API
2. **–ë–∞–∑–æ–≤–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è**: DTO —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Ñ–æ—Ä–º–∞—Ç–∞ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**: TelegramAuthGuard –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ userId
4. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ó–∞–ø–∏—Å—å –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
5. **–í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞**: –°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ seeds/content.json
6. **JWT –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞**: –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Å —Å—Ç—Ä–∞—Ç–µ–≥–∏–µ–π –∏ guard'–∞–º–∏
7. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è JWT —Ç–æ–∫–µ–Ω–æ–≤**: –í AuthService –ø–æ—Å–ª–µ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ Telegram –¥–∞–Ω–Ω—ã—Ö

## üö® **–¢–µ–∫—É—â–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏:**

### 1. **IDOR (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è) - JWT –ù–ï –ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø**
**–ü—Ä–æ–±–ª–µ–º–∞:** JWT —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω, –Ω–æ –≤—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç TelegramAuthGuard –≤–º–µ—Å—Ç–æ JwtAuthGuard
```bash
# –ó–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ª—é–±–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
GET /content/modules?userId=123456&level=A1
```

**–†–µ—à–µ–Ω–∏–µ:** –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –≤—Å–µ –∑–∞—â–∏—â–µ–Ω–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –Ω–∞ JwtAuthGuard

## üöÄ **–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —à–∞–≥–∏ –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ JWT:**

### –®–∞–≥ 1: –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã
```typescript
// –í –∫–∞–∂–¥–æ–º –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ –∑–∞–º–µ–Ω–∏—Ç—å:
import { JwtAuthGuard } from '../auth/jwt-auth.guard';

@UseGuards(TelegramAuthGuard)  // ‚ùå –£–¥–∞–ª–∏—Ç—å
@UseGuards(JwtAuthGuard)       // ‚úÖ –î–æ–±–∞–≤–∏—Ç—å
```

### –®–∞–≥ 2: –û–±–Ω–æ–≤–∏—Ç—å AuthController
```typescript
// AuthController.verify() —É–∂–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç accessToken
// –ù—É–∂–Ω–æ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –µ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç
```

### –®–∞–≥ 3: –û–±–Ω–æ–≤–∏—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥
```typescript
// –ü–æ—Å–ª–µ /auth/verify —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–∫–µ–Ω:
const { accessToken } = await authService.verify(telegramData);

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö:
headers: { Authorization: `Bearer ${accessToken}` }
```

### 2. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ rate limiting**
**–ü—Ä–æ–±–ª–µ–º–∞:** –í–æ–∑–º–æ–∂–Ω—ã DDoS-–∞—Ç–∞–∫–∏ –∏ –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è API
**–†–µ—à–µ–Ω–∏–µ:** Nginx rate limiting –∏–ª–∏ Redis-based middleware

### 3. **–°–ª–∞–±–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ Telegram –¥–∞–Ω–Ω—ã—Ö**
**–ü—Ä–æ–±–ª–µ–º–∞:** userId –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ, –Ω–æ –Ω–µ –Ω–∞ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç—å
**–†–µ—à–µ–Ω–∏–µ:** –°–≤—è–∑–∞—Ç—å —Å–µ—Å—Å–∏—é —Å –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–º–∏ Telegram-–¥–∞–Ω–Ω—ã–º–∏

## üéØ **–ü–ª–∞–Ω —É–ª—É—á—à–µ–Ω–∏–π (–ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É):**

### **–≠—Ç–∞–ø 1: –ê–∫—Ç–∏–≤–∞—Ü–∏—è JWT-–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (–ö–†–ò–¢–ò–ß–ù–û)**
```typescript
// ‚úÖ JWT —É–∂–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –≤ AuthService.verifyTelegramInitData()
// ‚úÖ JwtStrategy –∏ JwtAuthGuard —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã
// ‚ùå –ù–û: –≤—Å–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç TelegramAuthGuard

// –ù—É–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö:
@UseGuards(TelegramAuthGuard)  // ‚ùå –°—Ç–∞—Ä—ã–π —Å–ø–æ—Å–æ–±
@UseGuards(JwtAuthGuard)       // ‚úÖ –ù–æ–≤—ã–π —Å–ø–æ—Å–æ–±

// –§—Ä–æ–Ω—Ç–µ–Ω–¥ –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
GET /content/modules
Headers: Authorization: Bearer jwt-token
```

### **–≠—Ç–∞–ø 2: Rate Limiting**
```nginx
# –í nginx.conf
limit_req_zone $binary_remote_addr zone=api:10m rate=30r/m;
location /api/ {
    limit_req zone=api burst=10 nodelay;
}
```

### **–≠—Ç–∞–ø 3: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**
```typescript
// –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- –ß–∞—Å—Ç—ã–µ –∑–∞–ø—Ä–æ—Å—ã —Å —Ä–∞–∑–Ω—ã–º–∏ userId —Å –æ–¥–Ω–æ–≥–æ IP
- –î–æ—Å—Ç—É–ø –∫ –∫–æ–Ω—Ç–µ–Ω—Ç—É –≤—ã—Å–æ–∫–æ–≥–æ —É—Ä–æ–≤–Ω—è –±–µ–∑ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
- –ü–æ–ø—ã—Ç–∫–∏ –ø–µ—Ä–µ–±–æ—Ä–∞ userId
```

### **–≠—Ç–∞–ø 4: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è**
- CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è Telegram Mini App
- –í–∞–ª–∏–¥–∞—Ü–∏—è Telegram WebApp –¥–∞–Ω–Ω—ã—Ö –ø–æ –≤—Ä–µ–º–µ–Ω–∏
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- Pagination –¥–ª—è –±–æ–ª—å—à–∏—Ö —Å–ø–∏—Å–∫–æ–≤

## üîß **–ë—ã—Å—Ç—Ä—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**

### 1. –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å JWT (—Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞):
```typescript
// –í –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö –∑–∞–º–µ–Ω–∏—Ç—å:
@UseGuards(TelegramAuthGuard)  // ‚ùå
@UseGuards(JwtAuthGuard)       // ‚úÖ

// –§—Ä–æ–Ω—Ç–µ–Ω–¥ –¥–æ–ª–∂–µ–Ω –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å JWT —Ç–æ–∫–µ–Ω:
Headers: { Authorization: 'Bearer ' + token }
```

### 2. –í—Ä–µ–º–µ–Ω–Ω–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç IDOR (–µ—Å–ª–∏ JWT –ø–æ–∫–∞ –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω):
```typescript
// –í TelegramAuthGuard –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É IP/—Å–µ—Å—Å–∏–∏
if (requestedUserId !== sessionUserId && !isAdmin) {
  // –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
  return { error: 'Access denied' };
}
```

### 3. –û–±–Ω–æ–≤–∏—Ç—å AuthController –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ JWT:
```typescript
// AuthController.verify() —É–∂–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç accessToken
// –§—Ä–æ–Ω—Ç–µ–Ω–¥ –¥–æ–ª–∂–µ–Ω –µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
```

## üìä **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:**

### –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –æ–¥–Ω–æ–≥–æ IP
- –ß–∞—Å—Ç–æ—Ç–∞ —Å–º–µ–Ω—ã userId –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö
- –ü–æ–ø—ã—Ç–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º —Ä–µ—Å—É—Ä—Å–∞–º
- –ê–Ω–æ–º–∞–ª—å–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–æ—Å—Ç—É–ø –∫ —É—Ä–æ–∫–∞–º –±–µ–∑ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞)

### –ê–ª–µ—Ä—Ç—ã:
- –ë–æ–ª–µ–µ 100 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω —Å –æ–¥–Ω–æ–≥–æ IP
- –î–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º >5 —Ä–∞–∑–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –æ–¥–Ω–æ–≥–æ IP
- –ü–æ–ø—ã—Ç–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ –Ω–µ–æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω–æ–º—É –∫–æ–Ω—Ç–µ–Ω—Ç—É

## üéØ **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—é:**

**–ë—ã—Å—Ç—Ä–æ (1-2 –¥–Ω—è):**
- ‚úÖ JWT —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω, –Ω—É–∂–Ω–æ —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å
- –ó–∞–º–µ–Ω–∏—Ç—å TelegramAuthGuard –Ω–∞ JwtAuthGuard –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö
- –î–æ–±–∞–≤–∏—Ç—å nginx rate limiting

**–°—Ä–µ–¥–Ω–∏–π —Å—Ä–æ–∫ (1 –Ω–µ–¥–µ–ª—è):**
- –û–±–Ω–æ–≤–∏—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è JWT —Ç–æ–∫–µ–Ω–æ–≤
- –î–æ–±–∞–≤–∏—Ç—å Redis –¥–ª—è rate limiting
- –£–ª—É—á—à–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

**–î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ (1 –º–µ—Å—è—Ü):**
- –ü–æ–ª–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö IP
- Refresh —Ç–æ–∫–µ–Ω—ã –¥–ª—è –ø—Ä–æ–¥–ª–µ–Ω–∏—è —Å–µ—Å—Å–∏–π
