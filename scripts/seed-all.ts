/**
 * –ü–æ–ª–Ω–æ–µ —Å–∏–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
 * 
 * –í—ã–ø–æ–ª–Ω—è–µ—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —à–∞–≥–∏ –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Å–∏–¥–∏—Ä–æ–≤–∞–Ω–∏—è:
 * 1. –ú–∏–≥—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (—Å–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤)
 * 2. –°–∏–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (–º–æ–¥—É–ª–∏ –∏ —É—Ä–æ–∫–∏)
 * 3. –°–∏–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è (–∫–æ–≥–æ—Ä—Ç—ã)
 * 
 * Usage:
 *   ts-node scripts/seed-all.ts
 */

/**
 * –ü–æ–ª–Ω–æ–µ —Å–∏–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
 * 
 * –í—ã–ø–æ–ª–Ω—è–µ—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —à–∞–≥–∏ –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Å–∏–¥–∏—Ä–æ–≤–∞–Ω–∏—è:
 * 1. –ú–∏–≥—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (—Å–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤)
 * 2. –°–∏–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (–º–æ–¥—É–ª–∏ –∏ —É—Ä–æ–∫–∏)
 * 3. –°–∏–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è (–∫–æ–≥–æ—Ä—Ç—ã)
 * 
 * Usage:
 *   npm run seed:all
 *   –∏–ª–∏
 *   ts-node scripts/seed-all.ts
 */

import 'dotenv/config';
import { execSync } from 'child_process';
import * as path from 'path';

console.log('üöÄ –ù–∞—á–∏–Ω–∞–µ–º –ø–æ–ª–Ω–æ–µ —Å–∏–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...\n');

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
if (!process.env.MONGODB_URI) {
  console.error('‚ùå –û—à–∏–±–∫–∞: MONGODB_URI –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞');
  console.error('   –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª .env —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç MONGODB_URI');
  process.exit(1);
}

const projectRoot = path.join(__dirname, '..');

const steps = [
  {
    name: '–ú–∏–≥—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞',
    command: 'npm run migrate:content',
    description: '–°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ –¥–ª—è –º–æ–¥—É–ª–µ–π –∏ —É—Ä–æ–∫–æ–≤'
  },
  {
    name: '–°–∏–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞',
    command: 'npm run seed:content:apply',
    description: '–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥—É–ª–µ–π –∏ —É—Ä–æ–∫–æ–≤ –∏–∑ seeds/content.json'
  },
  {
    name: '–°–∏–¥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è',
    command: 'npm run seed:pricing',
    description: '–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –¥–ª—è –∫–æ–≥–æ—Ä—Ç'
  }
];

let successCount = 0;
let failCount = 0;
const failedSteps: string[] = [];

for (let i = 0; i < steps.length; i++) {
  const step = steps[i];
  console.log(`\n${'='.repeat(60)}`);
  console.log(`üì¶ –®–∞–≥ ${i + 1}/${steps.length}: ${step.name}`);
  console.log(`üìù ${step.description}`);
  console.log(`${'='.repeat(60)}\n`);

  try {
    execSync(step.command, {
      stdio: 'inherit',
      cwd: projectRoot,
      env: { ...process.env }
    });
    console.log(`\n‚úÖ ${step.name} - —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–æ`);
    successCount++;
  } catch (error: any) {
    console.error(`\n‚ùå ${step.name} - –æ—à–∏–±–∫–∞`);
    failCount++;
    failedSteps.push(step.name);
    
    // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–ª–µ–¥—É—é—â–∏—Ö —à–∞–≥–æ–≤
    console.log('‚ö†Ô∏è  –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–ª–µ–¥—É—é—â–∏—Ö —à–∞–≥–æ–≤...\n');
  }
}

console.log(`\n${'='.repeat(60)}`);
console.log('üìä –ò—Ç–æ–≥–∏ —Å–∏–¥–∏—Ä–æ–≤–∞–Ω–∏—è:');
console.log(`‚úÖ –£—Å–ø–µ—à–Ω–æ: ${successCount}/${steps.length}`);
console.log(`‚ùå –û—à–∏–±–æ–∫: ${failCount}/${steps.length}`);

if (failedSteps.length > 0) {
  console.log(`\n‚ö†Ô∏è  –®–∞–≥–∏ —Å –æ—à–∏–±–∫–∞–º–∏:`);
  failedSteps.forEach(step => console.log(`   - ${step}`));
}

console.log(`${'='.repeat(60)}\n`);

if (failCount > 0) {
  console.log('‚ö†Ô∏è  –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —à–∞–≥–∏ –∑–∞–≤–µ—Ä—à–∏–ª–∏—Å—å —Å –æ—à–∏–±–∫–∞–º–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤—ã—à–µ.');
  console.log('üí° –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ —à–∞–≥–∏ –æ—Ç–¥–µ–ª—å–Ω–æ –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏.');
  process.exit(1);
} else {
  console.log('üéâ –ü–æ–ª–Ω–æ–µ —Å–∏–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!');
  console.log('\nüìã –ß—Ç–æ –±—ã–ª–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ:');
  console.log('   ‚úì –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –º–æ–¥—É–ª–µ–π –∏ —É—Ä–æ–∫–æ–≤');
  console.log('   ‚úì –ú–æ–¥—É–ª–∏ –∏ —É—Ä–æ–∫–∏ –∏–∑ seeds/content.json');
  console.log('   ‚úì –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –¥–ª—è –≤—Å–µ—Ö –∫–æ–≥–æ—Ä—Ç');
  process.exit(0);
}

